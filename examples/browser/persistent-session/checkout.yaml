name: "Checkout persistent-session demo"
tests:
  - name: "happy path"
    steps:
      - name: "start browser"
        plugin: playwright
        config:
          role: start
          session_id: "checkout-{{ .run.id }}"
          headless: true
          slow_mo_ms: 0

      - name: "login (deterministic)"
        plugin: playwright
        config:
          role: script
          session_id: "checkout-{{ .run.id }}"
          language: python
          script: |
            page.goto("https://shop.example.com/login")
            page.get_by_label("Email").fill("qa@example.com")
            page.get_by_label("Password").fill("correct-horse-battery-staple")
            page.get_by_role("button", name="Sign in").click()
            page.wait_for_url("**/products")

      - name: "browse & add via agent"
        plugin: browser_use
        config:
          session_id: "checkout-{{ .run.id }}"
          task: "Navigate to the first product and click 'Add to cart'"
          allowed_domains:
            - "shop.example.com"
          max_steps: 10

      - name: "assert cart (deterministic)"
        plugin: playwright
        config:
          role: script
          session_id: "checkout-{{ .run.id }}"
          language: python
          script: |
            page.goto("https://shop.example.com/cart")
            assert page.get_by_text("1 item").is_visible()

      - name: "stop browser"
        plugin: playwright
        config:
          role: stop
          session_id: "checkout-{{ .run.id }}"
